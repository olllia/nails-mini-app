<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Nails & Aesthetic</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root {
  --primary: #1A1AA7; /* –ì–ª—É–±–æ–∫–∏–π —Å–∏–Ω–∏–π –∏–∑ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞ */
  --accent: #F295A0;  /* Dusty Rose */
  --text: #272A2A;
  --glass: rgba(255, 255, 255, 0.7);
  --radius: 28px;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  margin: 0;
  font-family: 'Space Grotesk', -apple-system, sans-serif;
  color: var(--text);
  /* –ò—Å–ø–æ–ª—å–∑—É–µ–º ./ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É */
  background: url('/Users/ooolya/nails-mini-app/2026-01-15 10.25.49‚ÄØPM.jpg') no-repeat center center fixed;
  background-size: cover;
  min-height: 100vh;
}

#app { 
  max-width: 420px; 
  margin: 0 auto; 
  padding: 20px 20px 100px; 
}

/* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–π —Å—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–µ–∫ */
.glass-card {
  background: var(--glass);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.4);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
}

header { 
    text-align: center; 
    margin-bottom: 30px; 
    padding-top: 10px;
}
header h1 { font-size: 32px; font-weight: 800; margin: 0; letter-spacing: -1px; color: var(--primary); }
.master-link { 
    display: inline-block;
    margin-top: 8px;
    color: var(--text);
    text-decoration: none;
    font-size: 14px;
    background: var(--accent);
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: 600;
}

.tabs { 
    display: flex; 
    gap: 8px;
    background: rgba(0,0,0,0.05); 
    padding: 5px; 
    border-radius: 20px; 
    margin-bottom: 25px; 
}
.tabs button { 
    flex: 1; border: none; padding: 12px; border-radius: 16px; 
    font-size: 14px; font-weight: 600; cursor: pointer; 
    background: transparent; color: var(--secondary); transition: 0.3s;
}
.tabs button.active { background: white; color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

.section-title { 
    font-size: 12px; font-weight: 800; text-transform: uppercase; 
    letter-spacing: 1.5px; color: var(--primary); margin: 0 0 15px 10px; 
}

/* –ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤ —Å—Ç–∏–ª–µ –¥—É–¥–ª–æ–≤ */
.calendar { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none; }
.day { 
  min-width: 65px; padding: 18px 10px; border-radius: 22px; text-align: center; 
  background: var(--glass); border: 1px solid transparent; transition: 0.3s;
}
.day.active { background: var(--primary); color: white; transform: translateY(-5px); }
.day span { font-size: 11px; opacity: 0.7; display: block; margin-bottom: 5px; }
.day b { font-size: 20px; }

/* –°–ª–æ—Ç—ã - –º—è–≥–∫–∏–µ —Ñ–æ—Ä–º—ã */
.slots-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
.slot { 
  padding: 15px; border-radius: 18px; text-align: center; 
  font-size: 15px; font-weight: 600; background: var(--glass); cursor: pointer; border: 1.5px solid transparent;
}
.slot.selected { border-color: var(--primary); color: var(--primary); background: white; }

/* –£—Å–ª—É–≥–∏ */
.service-item { 
    display: flex; justify-content: space-between; align-items: center; 
    padding: 15px 0; border-bottom: 1px solid rgba(0,0,0,0.05); 
}
.service-name { font-weight: 700; font-size: 16px; }
.checkbox { 
    width: 26px; height: 26px; border: 2px solid var(--primary); 
    border-radius: 10px; transition: 0.3s; 
}
.service-item.active .checkbox { background: var(--primary); box-shadow: 0 0 10px rgba(26, 26, 167, 0.3); }

/* –ò–Ω–ø—É—Ç—ã */
textarea { 
  width: 100%; border: none; border-radius: 20px; padding: 18px; 
  font-family: inherit; font-size: 15px; background: rgba(255,255,255,0.5); 
  resize: none; color: var(--text);
}

.total-amount { font-size: 38px; font-weight: 800; color: var(--primary); }

.btn-primary { 
  width: 100%; background: var(--primary); color: white; border: none; 
  border-radius: 22px; padding: 22px; font-size: 18px; font-weight: 700; 
  cursor: pointer; box-shadow: 0 10px 20px rgba(26, 26, 167, 0.2);
}

/* –°–∫—Ä—ã–≤–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ –±—ç–∫–≥—Ä–∞—É–Ω–¥—É */
#app { min-height: 100vh; }
</style>
</head>
<body onclick="document.activeElement.blur()">

<div id="app">
  <header>
    <h1>Nails & Aesthetic</h1>
    <a href="https://t.me/nnstmlll" class="master-link">master: @nnstmlll</a>
  </header>

  <div class="tabs">
    <button id="clientBtn" class="active">–ó–ê–ü–ò–°–¨</button>
    <button id="adminBtn">–ú–ê–°–¢–ï–†</button>
  </div>

  <div id="clientPanel">
    <div class="section-title">Date</div>
    <div class="calendar" id="calendar"></div>

    <div class="section-title" style="margin-top:30px;">Time</div>
    <div id="slots" class="slots-grid"></div>

    <div class="section-title" style="margin-top:30px;">Services</div>
    <div class="glass-card" id="servicesContainer"></div>

    <div class="section-title">Wishes</div>
    <div class="glass-card" style="padding: 10px;">
      <textarea id="comment" rows="3" placeholder="–î–ª–∏–Ω–∞, —Ñ–æ—Ä–º–∞, –∏–¥–µ–∏..." enterkeyhint="done" onclick="event.stopPropagation()"></textarea>
    </div>

    <div style="text-align:center; margin: 30px 0;">
      <div style="font-size: 13px; opacity: 0.6; font-weight: 700;">TOTAL</div>
      <div class="total-amount"><span id="totalDisplay">0</span> ‚ÇΩ</div>
    </div>

    <button class="btn-primary" onclick="submitBooking()">BOOK NOW ‚ú®</button>
  </div>

  <div id="adminPanel" style="display:none;">
    <div class="glass-card">
        <div class="section-title">Analytics</div>
        <div style="display:flex; justify-content: space-around; text-align:center;">
            <div><b id="statRevenue" style="font-size:24px; color:var(--primary);">0</b><br><small>–í—ã—Ä—É—á–∫–∞</small></div>
            <div><b id="statAvg" style="font-size:24px; color:var(--primary);">0</b><br><small>–°—Ä. —á–µ–∫</small></div>
        </div>
    </div>
    <div class="section-title">Add Slots</div>
    <div class="glass-card" style="background: #1a1a1a;">
      <textarea id="bulkInput" class="bulk-textarea" style="background:transparent; color:#a2fca2;" rows="5" placeholder="04.01 11:00/13:00" onclick="event.stopPropagation()"></textarea>
      <button class="btn-primary" style="margin-top:15px; background: white; color: black;" onclick="handleBulkUpload()">PUBLISH</button>
    </div>
    <div id="adminAppointments"></div>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
const API = "–¢–í–û–ô_URL_–ë–≠–ö–ï–ù–î–ê"; 
const ADMIN_ID = 381232429;

// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
function downloadIcs(date, time, services) {
    const [y, m, d] = date.split('-');
    const [hh, mm] = time.split(':');
    const start = `${y}${m}${d}T${hh}${mm}00`;
    
    const icsContent = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "BEGIN:VEVENT",
        `DTSTART:${start}`,
        `SUMMARY:–ú–∞–Ω–∏–∫—é—Ä —É –ù–∞—Å—Ç–∏ üíÖ`,
        `DESCRIPTION:–£—Å–ª—É–≥–∏: ${services}`,
        "DURATION:PT2H",
        "END:VEVENT",
        "END:VCALENDAR"
    ].join("\n");

    const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', 'nails_booking.ics');
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// –†–µ–Ω–¥–µ—Ä –∫–∞–ª–µ–Ω–¥–∞—Ä—è
const calendar = document.getElementById("calendar");
for (let i = 0; i < 14; i++) {
  const d = new Date(); d.setDate(d.getDate() + i);
  const iso = d.toISOString().split('T')[0];
  const div = document.createElement("div");
  div.className = "day";
  div.innerHTML = `<span>${["–í—Å","–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±"][d.getDay()]}</span><b>${d.getDate()}</b>`;
  div.onclick = (e) => {
    e.stopPropagation();
    document.querySelectorAll(".day").forEach(el => el.classList.remove("active"));
    div.classList.add("active");
    window.selectedDate = iso;
    loadSlots(iso);
  };
  calendar.appendChild(div);
}

// –ê–¥–º–∏–Ω–∫–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
async function loadStats() {
    const res = await fetch(`${API}/stats`);
    const data = await res.json();
    document.getElementById("statRevenue").innerText = `${data.revenue} ‚ÇΩ`;
    document.getElementById("statAvg").innerText = `${data.avg} ‚ÇΩ`;
}

async function loadServices() {
  const res = await fetch(`${API}/services`);
  const data = await res.json();
  const container = document.getElementById("servicesContainer");
  data.forEach(s => {
    const item = document.createElement("div");
    item.className = "service-item";
    item.innerHTML = `<div><div class="service-name">${s.name}</div><div class="service-price">${s.price} ‚ÇΩ</div></div><div class="checkbox"></div>`;
    item.onclick = () => {
      const idx = selectedServices.findIndex(srv => srv.id === s.id);
      if(idx === -1) { selectedServices.push(s); item.classList.add("active"); }
      else { selectedServices.splice(idx, 1); item.classList.remove("active"); }
      document.getElementById("totalDisplay").innerText = selectedServices.reduce((sum, srv) => sum + srv.price, 0);
    };
    container.appendChild(item);
  });
}

// –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
async function submitBooking() {
  if(!selectedSlotId) return tg.showAlert("–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è!");
  if(selectedServices.length === 0) return tg.showAlert("–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É!");

  const total = parseInt(document.getElementById("totalDisplay").innerText);
  tg.MainButton.setText("–û—Ñ–æ—Ä–º–ª—è–µ–º...").show();
  
  try {
    const res = await fetch(`${API}/book`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        slotId: selectedSlotId, userId, userName,
        services: selectedServices.map(s => s.name),
        totalPrice: total, comment: document.getElementById("comment").value
      })
    });
    
    if(res.ok) {
      tg.showPopup({
        title: "–ó–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!",
        message: "–î–æ–±–∞–≤–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Ç–µ–ª–µ—Ñ–æ–Ω–∞?",
        buttons: [{id: 'ics', type: 'default', text: 'üóì –î–æ–±–∞–≤–∏—Ç—å'}, {type: 'close', text: '–ù–µ—Ç'}]
      }, (btnId) => {
        if(btnId === 'ics') {
          const slotTime = document.querySelector(".slot.selected").innerText;
          downloadIcs(selectedDate, slotTime, selectedServices.map(s => s.name).join(", "));
        }
        tg.close();
      });
    }
  } catch(e) { tg.showAlert("–û—à–∏–±–∫–∞!"); }
  finally { tg.MainButton.hide(); }
}

// –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ (loadSlots, submitBooking –∏ —Ç.–¥.) –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π, 
// –Ω–æ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
document.getElementById('comment').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        this.blur(); // –°–∫—Ä—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
    }
});

// –ù–µ –∑–∞–±—É–¥—å –≤—Å—Ç–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ loadSlots, loadServices, submitBooking –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞!
// –Ø –∏—Ö —Ç—É—Ç —Å–æ–∫—Ä–∞—Ç–∏–ª, —á—Ç–æ–±—ã –ø–æ–º–µ—Å—Ç–∏–ª—Å—è –¥–∏–∑–∞–π–Ω
</script>
</body>
</html>