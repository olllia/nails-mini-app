<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ½Ğ° Ğ½Ğ¾Ğ³Ğ¾Ñ‚Ğ¾Ñ‡ĞºĞ¸</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    button { padding: 10px; margin: 5px 0; width: 100%; }
    .admin { background: #ffe4e1; padding: 10px; }
  </style>
</head>
<body>

<h2>ğŸ’… Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ</h2>
<div id="content"></div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const user = tg.initDataUnsafe.user;
const ADMIN_ID = 123456789; // Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ id

const content = document.getElementById("content");

// --- ĞĞ”ĞœĞ˜Ğ ---
if (user.id === ADMIN_ID) {
  content.innerHTML = `
    <div class="admin">
      <h3>ğŸ‘©â€ğŸ¨ ĞĞ´Ğ¼Ğ¸Ğ½ĞºĞ°</h3>
      <input type="date" id="date">
      <input type="time" id="time">
      <button onclick="addSlot()">â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾ĞºĞ¾ÑˆĞºĞ¾</button>
      <button onclick="loadAppointments()">ğŸ“‹ Ğ—Ğ°Ğ¿Ğ¸ÑĞ¸</button>
      <div id="list"></div>
    </div>
  `;
}

// --- ĞšĞ›Ğ˜Ğ•ĞĞ¢ ---
loadSlots();

function loadSlots() {
  fetch("http://localhost:3000/slots")
    .then(r => r.json())
    .then(slots => {
      slots.forEach(s => {
        const btn = document.createElement("button");
        btn.innerText = `${s.date} ${s.time} â€” Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ`;
        btn.onclick = () => book(s.id);
        content.appendChild(btn);
      });
    });
}

function book(slotId) {
  fetch("http://localhost:3000/book", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      slotId,
      userId: user.id,
      userName: user.first_name
    })
  }).then(() => {
    alert("Ğ’Ñ‹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ»Ğ¸ÑÑŒ ğŸ’…");
    tg.close();
  });
}

function addSlot() {
  fetch("http://localhost:3000/slots", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      date: date.value,
      time: time.value,
      userId: user.id
    })
  }).then(() => alert("Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾"));
}

function loadAppointments() {
  fetch(`http://localhost:3000/appointments/${user.id}`)
    .then(r => r.json())
    .then(list => {
      document.getElementById("list").innerHTML =
        list.map(a => `${a.date} ${a.time} â€” ${a.user_name}`).join("<br>");
    });
}
</script>

</body>
</html>
